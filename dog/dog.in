#!/bin/bash

JAVA_HOME=@JAVA_HOME@

dog=`readlink -mn $0`
jarfile=`dirname $dog`/dog.jar
port=7000
foreground=0

arg=$*

while [ "$1" != "" ]
do
    if [ $1 = "-f" -o $1 = "--foreground" ]
    then
	foreground=1
    fi
    if [ $1 = "-p" -o $1 = "--dport" ]
    then
	shift
	port=$1
    fi
    shift
done

if [ $foreground -gt 0 ]
then
    java -jar $jarfile $arg
else
    logfile=/tmp/sheepdog-$port
    jsvc -home $JAVA_HOME -wait 10000 -outfile $logfile.out -errfile $logfile.err -pidfile $logfile.pid -user `whoami` -cp $jarfile net.osrg.sheepdog.Sheepdog $arg
    if [ $? != 0 ]
    then
	# show error messages
	java -jar $jarfile $arg
    fi
fi
